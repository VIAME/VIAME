# =============================================================================
# SAM2 (Segment Anything Model 2) Segmenter Configuration
#
# This file contains shared configuration for SAM2-based segmentation pipelines.
# Include this file in any pipeline that uses SAM2 for segmentation.
#
# Usage: include common_sam2_segmenter.conf
#
# SAM2 is Meta's native SAM implementation supporting:
# - Point-based interactive segmentation
# - Box-prompted segmentation
# - Video object tracking with memory attention
#
# Model files expected in models/ directory:
# - sam2_hbp.pt : SAM2 Hiera Base Plus weights (~390MB)
#
# Or use the built-in config for auto-download from HuggingFace.
# =============================================================================

# -----------------------------------------------------------------------------
# SAM2 Model Paths (relative to pipelines directory)
# -----------------------------------------------------------------------------
relativepath sam2:checkpoint = models/sam2_hbp.pt

# SAM2 config (uses hydra configs from sam2 package)
sam2:cfg = configs/sam2.1/sam2.1_hiera_b+.yaml

# Alternative: Use HuggingFace model ID (for downloading from HuggingFace Hub)
# Leave checkpoint empty to use HuggingFace Hub
sam2:hf_model_id = facebook/sam2.1-hiera-base-plus

# -----------------------------------------------------------------------------
# Device Configuration
# -----------------------------------------------------------------------------
sam2:device = cuda

# -----------------------------------------------------------------------------
# Image Processing Parameters
# -----------------------------------------------------------------------------
# SAM2 uses 1024x1024 image size
sam2:image_size = 1024

# -----------------------------------------------------------------------------
# Segmentation Output Parameters
# -----------------------------------------------------------------------------
# Polygon simplification (Douglas-Peucker epsilon relative to perimeter)
# Set to 0 to disable simplification
sam2:polygon_simplification = 0.01

# Maximum polygon points for output
sam2:max_polygon_points = 30

# Hole policy: "allow" keeps holes, "remove" fills them
sam2:hole_policy = allow

# Multipolygon policy: "allow", "convex_hull", or "largest"
sam2:multipolygon_policy = largest

# Output type: "polygon", "mask", or "both"
sam2:output_type = polygon

# -----------------------------------------------------------------------------
# Detection/Refinement Parameters
# -----------------------------------------------------------------------------
# Minimum mask area in pixels (smaller masks are filtered out)
sam2:min_mask_area = 10

# Whether to filter by mask quality score
sam2:filter_by_quality = true

# Whether to adjust bounding boxes to fit refined masks
sam2:adjust_boxes = false

# Whether to overwrite existing masks/polygons
sam2:overwrite_existing = true

# -----------------------------------------------------------------------------
# Video Tracking Parameters
# -----------------------------------------------------------------------------
# Number of memory frames for video tracking
sam2:num_maskmem = 7

# Maximum number of tracked objects
sam2:max_num_objects = 10000

# Track keep-alive frames
sam2:max_trk_keep_alive = 30
sam2:init_trk_keep_alive = 30

# Score thresholds
sam2:score_threshold_detection = 0.5
sam2:new_det_thresh = 0.7
sam2:high_conf_thresh = 0.8

# IoU thresholds
sam2:assoc_iou_thresh = 0.1
sam2:trk_assoc_iou_thresh = 0.5
sam2:high_iou_thresh = 0.8

# NMS threshold for detections
sam2:det_nms_thresh = 0.1

# -- end of file --
