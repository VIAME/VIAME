# =============================================================================
# SAM3 (Segment Anything Model 3) Segmenter Configuration
#
# This file contains shared configuration for SAM3-based segmentation pipelines.
# Include this file in any pipeline that uses SAM3 for segmentation.
#
# Usage: include common_sam3_segmenter.conf
#
# SAM3 is a HuggingFace-style model supporting:
# - Point-based interactive segmentation
# - Box-prompted segmentation
# - Text-based object detection and segmentation (via CLIP text encoder)
# - Video object tracking with memory attention
#
# Model files expected in models/ directory:
# - sam3_weights.pt          : Model weights (~3.4GB)
# - sam3_config.json         : Model architecture configuration
# - sam3_processor_config.json : Image/video processor configuration
# - sam3_tokenizer.json      : Text tokenizer (for text queries)
# - sam3_tokenizer_config.json
# - sam3_vocab.json
# - sam3_special_tokens_map.json
# =============================================================================

# -----------------------------------------------------------------------------
# SAM3 Model Paths (relative to pipelines directory)
# -----------------------------------------------------------------------------
relativepath sam3:checkpoint =          models/sam3_weights.pt
relativepath sam3:model_config =        models/sam3_config.json
relativepath sam3:processor_config =    models/sam3_processor_config.json
relativepath sam3:tokenizer =           models/sam3_tokenizer.json
relativepath sam3:tokenizer_config =    models/sam3_tokenizer_config.json
relativepath sam3:vocab =               models/sam3_vocab.json
relativepath sam3:special_tokens =      models/sam3_special_tokens_map.json

# Alternative: Use HuggingFace model ID (for downloading from HuggingFace Hub)
# Set sam3:use_local to false to use HuggingFace Hub instead of local files
sam3:use_local = true
sam3:hf_model_id = facebook/sam3-hiera-large

# -----------------------------------------------------------------------------
# Device Configuration
# -----------------------------------------------------------------------------
sam3:device = cuda

# -----------------------------------------------------------------------------
# Image Processing Parameters
# -----------------------------------------------------------------------------
# SAM3 uses 1008x1008 image size (vs SAM2's 1024x1024)
sam3:image_size = 1008
sam3:mask_size = 288

# -----------------------------------------------------------------------------
# Segmentation Output Parameters
# -----------------------------------------------------------------------------
# Polygon simplification (Douglas-Peucker epsilon relative to perimeter)
# Set to 0 to disable simplification
sam3:polygon_simplification = 0.01

# Maximum polygon points for output
sam3:max_polygon_points = 30

# Hole policy: "allow" keeps holes, "remove" fills them
sam3:hole_policy = allow

# Multipolygon policy: "allow", "convex_hull", or "largest"
sam3:multipolygon_policy = largest

# Output type: "polygon", "mask", or "both"
sam3:output_type = polygon

# -----------------------------------------------------------------------------
# Detection/Refinement Parameters
# -----------------------------------------------------------------------------
# Minimum mask area in pixels (smaller masks are filtered out)
sam3:min_mask_area = 10

# Whether to filter by mask quality score
sam3:filter_by_quality = true

# Whether to adjust bounding boxes to fit refined masks
sam3:adjust_boxes = false

# -----------------------------------------------------------------------------
# Text Query Parameters (for text-based detection)
# -----------------------------------------------------------------------------
# Detection confidence threshold
sam3:detection_threshold = 0.3

# Text matching threshold
sam3:text_threshold = 0.25

# -----------------------------------------------------------------------------
# Video Tracking Parameters
# -----------------------------------------------------------------------------
# Number of memory frames for video tracking
sam3:num_maskmem = 7

# Maximum number of tracked objects
sam3:max_num_objects = 10000

# Track keep-alive frames
sam3:max_trk_keep_alive = 30
sam3:init_trk_keep_alive = 30

# Score thresholds
sam3:score_threshold_detection = 0.5
sam3:new_det_thresh = 0.7
sam3:high_conf_thresh = 0.8

# IoU thresholds
sam3:assoc_iou_thresh = 0.1
sam3:trk_assoc_iou_thresh = 0.5
sam3:high_iou_thresh = 0.8

# NMS threshold for detections
sam3:det_nms_thresh = 0.1

# -- end of file --
