# =============================================================================
# Title: Train Detector - MIT YOLO 640
#
# Description: Configuration for training YOLO. Uses the NetHarn deep learning
# framework. Input resolution: 640px.
# =============================================================================

include common_train_detector.conf

#  Override default validation percentage
default_percent_validation = 0.30

#  Augmentation pipeline.
#relativepath augmentation_pipeline = train_hue_shifting_only_aug.pipe

#  Augmentatation cache.
augmentation_cache = augmented_images

#  Do not regenerate cache.
regenerate_cache = true


#  Algorithm to use for 'detector_trainer'.
detector_trainer:type = ocv_windowed

block detector_trainer:ocv_windowed

  # Directory for all files used in training
  train_directory = deep_training

  # Windowing mode, can be disabled, maintain_ar, scale, chip, adaptive
  mode = disabled

  # Resized chip width.
  chip_width = 640

  # Resized chip height.
  chip_height = 640

  # Adaptive size threshold for chipping
  chip_adaptive_thresh = 1600000

  # Don't train on chips with detections smaller than this
  min_train_box_length = 5

  # Uncomment to remove small detections instead of training on them
  small_box_area = 200
  small_action = remove

  # Image reader type
  image_reader:type = vxl

endblock

block detector_trainer:ocv_windowed:trainer

  # Trainer type
  type = mit_yolo

  # The architecture
  mit_yolo:model = v9-c

  # Number of GPUs to use, -1 indicates all
  mit_yolo:gpu_count = -1

  # Network perspective field size
  mit_yolo:chip_width = 640

  # Path to pretrained state
  relativepath mit_yolo:weight = true

  #  Pipeline template file.
  #relativepath mit_yolo:pipeline_template = templates/embedded_netharn.pipe

  # Image train batch size
  mit_yolo:batch_size = 4
  mit_yolo:max_epochs = 5

  # Training learning rate
  mit_yolo:learning_rate = 1e-3

endblock

